#                                                     数据库实操技巧



# 数据库量表来求差集



## 什么是差集

一般地，设A，B是两个 集合，由所有属于A且不属于B的元素组成的集合，叫做集合A减 集合B( 或 集合A与集合B之差)

A={1,2,3,4}

B={1,4,5}

A-B={2,3}

## 实际的应用场景

需求： 有两张数据库表 A（会员表）， B (需要加权限的表) 。现在需要去除掉A表中和B表某一字段相同的一些记录。

 方案一：not in的查询

~~~sql
SELECT
	id
FROM
	blog 
WHERE
	id NOT IN (SELECT id FROM usertable)
// 这里usertable是B表，blog表示A表
//缺点：not in的查询效率是极度低下的
~~~



方案二：左链接查询

~~~sql
SELECT
	id
FROM
	blog 
LEFT JOIN (SELECT id AS i FROM usertable) AS t1 ON usertable.id = t1.i
WHERE
	t1.i IS NULL
//// 这里usertable是B表，blog表示A表
//这里blog的id，也就是t1中的id，还必须换成i，或者其它变量名，不然连接的时候会出现混乱
对上面sql语句解释 
A  1 2 3 4
B  1     4 5
A left join B
  1 2 3 4|
  1     4| 5
然后取B中在左联合中为空那就是2 3 
~~~



实际例子：

~~~mysql
SELECT
		*
		FROM
		(
		SELECT
		*
		FROM
		member
		LEFT JOIN (
		SELECT
		USER_MOBILE AS i
		FROM
		databoard_user
		) AS t1 ON member.MOBILE = t1.i
		WHERE
		t1.i IS NULL
		) AS a
		<dynamic prepend="where">
			<isNotEmpty prepend="and" property="mobile">
				a.MOBILE=#mobile#
			</isNotEmpty>
		</dynamic>
~~~





